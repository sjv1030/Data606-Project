---
title: "Data 606 - Data Project Proposal"
author: "Silverio Vasquez"
date: "October 22, 2017"
output: html_document
---

### Data Preparation

```{r setup, echo=TRUE, results='hide', warning=FALSE, message=FALSE}

# install.packages("Quandl")
# install.packages("dygraphs")
library(Quandl)
library(tidyverse)
library(zoo)
library(xts)
# library(dygraphs)
library(psych)

Quandl.api_key("TWp9zrWTMziHW_hbugiN")

# Load necessary EIA data from Quandl 
f1 <- Quandl("EIA/PET_RCLC1_M", type="xts")
f2 <- Quandl("EIA/PET_RCLC2_M", type="xts")
f3 <- Quandl("EIA/PET_RCLC3_M", type="xts")
f4 <- Quandl("EIA/PET_RCLC4_M", type="xts")
wti_stock <- Quandl("EIA/STEO_COSXPUS_M", type="xts")
gas_stock <- Quandl("EIA/STEO_MGTSPUS_M", type="xts")

# Calculate monthly, 3-month, 6-month, and annual changes in both oil and gasoline inventory data
wstkd <- diff(log(wti_stock))
wstkd3 <- diff(log(wti_stock),lag=3)
wstkd6 <- diff(log(wti_stock),lag=6)
wstkd12 <- diff(log(wti_stock),lag=12)

gstkd <- diff(log(gas_stock))
gstkd3 <- diff(log(gas_stock),lag=3)
gstkd6 <- diff(log(gas_stock),lag=6)
gstkd12 <- diff(log(gas_stock),lag=12)

# Lag the independent variables by 1 month since we want to use them as leading indicators
wstkdL1 <- lag(wstkd,1)
wstkd3L1 <- lag(wstkd3,1)
wstkd6L1 <- lag(wstkd6,1)
wstkd12L1 <- lag(wstkd12,1)

gstkdL1 <- lag(gstkd,1)
gstkd3L1 <- lag(gstkd3,1)
gstkd6L1 <- lag(gstkd6,1)
gstkd12L1 <- lag(gstkd12,1)

# Create calendar spreads and return sign. Positive means curve is in contango, and negative means curve is in backwardation. Since all the variables are of XTS data type, the dates are automatically taken into account.

f1_2 <- sign(f2-f1)
f1_3 <- sign(f3-f1)
f1_4 <- sign(f4-f1)
f2_3 <- sign(f3-f2)
f2_4 <- sign(f4-f2)
f3_4 <- sign(f4-f3)

# Combine all the data:

df <- na.omit(cbind(f1_2,f1_3,f1_4,f2_3,f2_4,f3_4,wstkdL1,wstkd3L1,wstkd6L1,wstkd12L1,gstkdL1,gstkd3L1,gstkd6L1,gstkd12L1))

colnames(df) <- c('f1_2','f1_3','f1_4','f2_3','f2_4','f3_4','wstkdL1','wstkd3L1','wstkd6L1','wstkd12L1','gstkdL1','gstkd3L1','gstkd6L1','gstkd12L1')

```


### Research question 

Are changes in WTI and gasoline inventory predictive of an upward sloping (contango) or downward sloping (backwardation) oil curve 2-,3-,4-months out?


### Cases 

**What are the cases, and how many are there?**

Each case represents a monthly observation of a futures contract and inventory data. There are `r nrow(df)` observations in the given data set.


### Data collection 

**Describe the method of data collection.**

Data is reported by the [U.S. Energy Information Administration](http://eia.gov//) (EIA) and available via [Quandl](http://quandl.com/eia/).


### Type of study 

**What type of study is this (observational/experiment)?**

This is an observational study.


### Data Source 

**If you collected the data, state self-collected. If not, provide a citation/link.**

Data is collected by the EIA and is available online here: http://quandl.com/eia/ For this project, data was extracted using the `Quandl` R package.


### Response 

**What is the response variable, and what type is it (numerical/categorical)?**

The response variable is the shape of the oil futures curve and is binary: +1 for upward sloping (contango), or -1 for downward sloping (backwardation).


### Explanatory 

**What is the explanatory variable, and what type is it (numerical/categorival)?**

The explanatory variables are numerical - percent change in oil and gasoline inventory data.


### Relevant summary statistics 

**Provide summary statistics relevant to your research question. For example, if you're comparing means across groups provide means, SDs, sample sizes of each group. This step requires the use of R, hence a code chunk is provided below. Insert more code chunks as needed.**

```{r}
describe(df[,1:6])
describe(df[,7:14]*100)

table(df$f1_2)
prop.table(table(df$f1_2)) * 100

table(df$f1_3)
prop.table(table(df$f1_3)) * 100

table(df$f1_4)
prop.table(table(df$f1_4)) * 100

table(df$f2_3)
prop.table(table(df$f2_3)) * 100

table(df$f2_4)
prop.table(table(df$f2_4)) * 100

boxplot(coredata(df[,7:14]*100),col=c('powderblue'),main="Boxplots of the Explanatory Variables",ylab="%",las=2)
```
